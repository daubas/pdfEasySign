<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>簡易 PDF 簽名工具</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 pdf.js (渲染 PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <!-- 載入 pdf-lib.js (修改 PDF) -->
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <!-- 載入 signature_pad.js (簽名版) - 更換為 UMD 版本 -->
        <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
        <link rel="stylesheet" href="style.css">
        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    </head>
    <body class="p-4 md:p-8">
        <div id="starfield"></div>
        <div class="citadel-container">
            <h1 class="text-3xl font-bold text-center mb-6">
                PDF Signing Protocol
            </h1>
            
            <!-- 步驟一：上傳 -->
            <div id="uploadContainer" class="text-center">
                <label for="pdfUpload" class="mb-2">Select Document for Signature</label>
                <input type="file" id="pdfUpload" accept="application/pdf" class="block w-full max-w-md mx-auto">
            </div>
    
            <!-- 訊息與載入區域 -->
            <div id="messageArea" class="text-center my-4"></div>
    
            <!-- 步驟二：簽名 (PDF 預覽) -->
            <div id="pdfContainer" class="hidden my-4">
                <div id="zoomControls" class="sticky top-0 z-10 flex justify-center items-center gap-2 mb-4 flex-wrap">
                    <button id="zoomOutButton" class="p-2 rounded-full">-</button>
                    <span class="font-medium px-2">Signature Scale</span>
                    <button id="zoomInButton" class="p-2 rounded-full">+</button>
                    
                    <div class="border-l h-6 mx-3 opacity-30"></div>
    
                    <button id="pdfUndoButton" class="p-2 rounded-full" disabled>Undo</button>
                    <span class="font-medium px-2">History</span>
                    <button id="pdfRedoButton" class="p-2 rounded-full" disabled>Redo</button>
    
                    <div class="border-l h-6 mx-3 opacity-30"></div>
    
                    <button id="newSignatureButton" class="btn">New Signature</button>
                </div>
                
                <p id="pdfMessage" class="text-center text-lg font-medium text-indigo-600 mb-4"></p>
                <div class="overflow-x-auto">
                    <canvas id="pdfCanvas"></canvas>
                </div>
            </div>
    
            <!-- 步驟三：下載 -->
            <div id="downloadContainer" class="text-center hidden mt-6">
                <div class="mb-4 max-w-md mx-auto">
                    <label for="fileName" class="block text-sm mb-1 text-left">Download Filename</label>
                    <input type="text" id="fileName" value="signed_document" placeholder="e.g., my_signed_pdf">
                </div>
    
                <button id="downloadButton" class="btn btn-primary w-full max-w-md mx-auto">
                    Download Signed PDF
                </button>
            </div>
        </div>
    
        <!-- 簽名 Modal 彈窗 -->
        <div id="signatureModal">
            <div class="modal-content">
                <h3 class="text-xl font-semibold mb-4 text-center">Authorize via Signature</h3>
                <canvas id="signaturePad" class="mx-auto w-full h-64"></canvas>
                <div class="flex justify-center gap-2 md:gap-4 mt-4">
                    <button id="cancelSigButton" class="btn btn-gray">Cancel</button>
                    <button id="clearSigButton" class="btn">Clear</button>
                    <button id="saveSigButton" class="btn btn-primary">Save Signature</button>
                </div>
            </div>
        </div>
    
        <script type="module" src="app.js"></script>
    </body>
    </html>
    