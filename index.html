<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>簡易 PDF 簽名工具</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 pdf.js (渲染 PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <!-- 載入 pdf-lib.js (修改 PDF) -->
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <!-- 載入 signature_pad.js (簽名版) - 更換為 UMD 版本 -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
        <link rel="stylesheet" href="style.css">
    </head>
    <body class="p-4 md:p-8">
        <div class="max-w-5xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-lg">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
                簡易 PDF 簽名工具
            </h1>
            
            <!-- 步驟一：上傳 -->
            <div id="uploadContainer" class="text-center">
                <label for="pdfUpload" class="mb-2 block text-lg font-medium text-gray-700">請選擇要簽署的 PDF 檔案</label>
                <input type="file" id="pdfUpload" accept="application/pdf" class="block w-full max-w-md mx-auto text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-lg file:border-0
                    file:text-sm file:font-semibold
                    file:bg-blue-50 file:text-blue-700
                    hover:file:bg-blue-100 transition duration-200
                    cursor-pointer">
            </div>
    
            <!-- 訊息與載入區域 -->
            <div id="messageArea" class="text-center my-4"></div>
    
            <!-- 步驟二：簽名 (PDF 預覽) -->
            <div id="pdfContainer" class="hidden my-4">
                <!-- 縮放與上一步/下一步 控制按鈕 -->
                <!-- 修改：新增 sticky, top-0, z-10, bg-white, py-3, shadow-sm 讓控制列固定在頂部 -->
                <div id="zoomControls" class="sticky top-0 z-10 flex justify-center items-center gap-2 mb-4 flex-wrap bg-white py-3 shadow-sm">
                    <!-- 簽名縮放 -->
                    <button id="zoomOutButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold p-2 rounded-full shadow transition duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 13H7" />
                        </svg>
                    </button>
                    <span class="text-gray-700 font-medium px-2">簽名縮放</span>
                    <button id="zoomInButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold p-2 rounded-full shadow transition duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3h-6" />
                        </svg>
                    </button>
                    
                    <!-- 分隔線 -->
                    <div class="border-l h-6 mx-3 border-gray-300"></div>
    
                    <!-- PDF 上一步/下一步 -->
                    <button id="pdfUndoButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold p-2 rounded-full shadow transition duration-200" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z" />
                        </svg>
                    </button>
                    <span class="text-gray-700 font-medium px-2">PDF 狀態</span>
                    <button id="pdfRedoButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold p-2 rounded-full shadow transition duration-200" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 15l3-3m0 0l-3-3m3 3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </button>
    
                    <!-- 分隔線 -->
                    <div class="border-l h-6 mx-3 border-gray-300"></div>
    
                    <!-- 新增：更換簽名按鈕 -->
                    <button id="newSignatureButton" class="bg-blue-100 hover:bg-blue-200 text-blue-800 font-medium py-2 px-4 rounded-lg shadow transition duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                        </svg>
                        新增/更換簽名
                    </button>
                </div>
                
                <p id="pdfMessage" class="text-center text-lg font-medium text-indigo-600 mb-4"></p>
                <div class="overflow-x-auto">
                    <!-- PDF 渲染畫布 -->
                    <canvas id="pdfCanvas"></canvas>
                </div>
            </div>
    
            <!-- 步驟三：下載 -->
            <div id="downloadContainer" class="text-center hidden mt-6">
                <!-- 新增：下載檔名輸入框 -->
                <div class="mb-4 max-w-md mx-auto">
                    <label for="fileName" class="block text-sm font-medium text-gray-700 mb-1 text-left">下載檔名</label>
                    <input type="text" id="fileName" value="signed_document" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="例如：my_signed_pdf">
                </div>
    
                <button id="downloadButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg shadow-md transition duration-300 transform hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    下載已簽名的 PDF
                </button>
            </div>
        </div>
    
        <!-- 簽名 Modal 彈窗 -->
        <div id="signatureModal" class="">
            <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-lg m-4">
                <h3 class="text-xl font-semibold mb-4 text-center">請在下方空白處簽名</h3>
                <!-- 簽名畫布 - 移除固定 width/height, 改用 class h-64 -->
                <canvas id="signaturePad" class="mx-auto w-full h-64"></canvas>
                <div class="flex justify-center gap-2 md:gap-4 mt-4">
                    <!-- 移除：簽名板 上一步/下一步 按鈕 -->
                    
                    <!-- 新增：取消按鈕 -->
                    <button id="cancelSigButton" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-200">
                        取消
                    </button>
                    <button id="clearSigButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 md:px-6 rounded-lg transition duration-200">
                        清除
                    </button>
                    <button id="saveSigButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 md:px-6 rounded-lg transition duration-200">
                        儲存
                    </button>
                </div>
            </div>
        </div>
    
        <script type="module" src="app.js"></script>
    </body>
    </html>
    