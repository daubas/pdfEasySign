<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>簡易 PDF 簽名工具</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 pdf.js (渲染 PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <!-- 載入 pdf-lib.js (修改 PDF) -->
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <!-- 載入 signature_pad.js (簽名版) - 更換為 UMD 版本 -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <!-- Adobe Fonts for Trajan Pro (example) & Google Fonts for Roboto -->
    <link rel="stylesheet" href="https://use.typekit.net/af/trajan-pro-3/p.css?k=jkn5pzv&s=1&f=1&a=1&js=1&app=typekit&e=css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="citadel-container">
        <h1 class="text-3xl font-bold text-center mb-6">
            帝國簽署儀式
        </h1>
        
        <!-- How to Use Section -->
        <div id="instructionsContainer" class="text-center">
            <ul class="instructions-list">
                <li><strong>第一條令：</strong>上傳神聖的 PDF 文件。</li>
                <li><strong>第二條令：</strong>在文件上指定簽署位置，並在彈出的紀錄儀上完成你的印記。</li>
                <li><strong>第三條令：</strong>確認無誤後，下載蓋有印記的已認證文件。</li>
            </ul>
        </div>

        <!-- 步驟一：上傳 -->
        <div id="uploadContainer" class="text-center">
            <label for="pdfUpload" class="mb-2">選擇文件</label>
            <input type="file" id="pdfUpload" accept="application/pdf" class="block w-full max-w-md mx-auto">
        </div>

        <!-- 訊息與載入區域 -->
        <div id="messageArea" class="text-center my-4"></div>

        <!-- 步驟二：簽名 (PDF 預覽) -->
        <div id="pdfContainer" class="hidden my-4">
            <div id="zoomControls" class="sticky top-0 z-10">
                <button id="zoomOutButton" title="縮小印記">-</button>
                <span class="font-medium px-2">印記尺寸</span>
                <button id="zoomInButton" title="放大印記">+</button>
                
                <div class="border-l h-6 mx-3 opacity-30"></div>

                <button id="pdfUndoButton" disabled>撤銷</button>
                <span class="font-medium px-2">時間線</span>
                <button id="pdfRedoButton" disabled>重做</button>

                <div class="border-l h-6 mx-3 opacity-30"></div>

                <button id="newSignatureButton" class="btn">更新印記</button>
            </div>
            
            <p id="pdfMessage" class="text-center text-lg font-medium text-indigo-600 mb-4"></p>
            <div class="overflow-x-auto">
                <canvas id="pdfCanvas"></canvas>
            </div>
        </div>

        <!-- 步驟三：下載 -->
        <div id="downloadContainer" class="text-center hidden mt-6">
            <div class="mb-4 max-w-md mx-auto">
                <label for="fileName" class="block text-sm mb-1 text-left">文件命名</label>
                <input type="text" id="fileName" value="已認證文件" placeholder="例如：忠誠紀錄_01">
            </div>

            <button id="downloadButton" class="btn btn-primary w-full max-w-md mx-auto">
                下載已認證文件
            </button>
        </div>
    </div>

    <!-- 簽名 Modal 彈窗 -->
    <div id="signatureModal">
        <div class="modal-content">
            <h3 class="text-xl font-semibold mb-4 text-center">在紀錄儀上留下你的印記</h3>
            <canvas id="signaturePad" class="mx-auto w-full h-64"></canvas>
            <div class="flex justify-center gap-2 md:gap-4 mt-4">
                <button id="cancelSigButton" class="btn btn-gray">取消</button>
                <button id="clearSigButton" class="btn">清除</button>
                <button id="saveSigButton" class="btn btn-primary">確認印記</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
    </html>
    