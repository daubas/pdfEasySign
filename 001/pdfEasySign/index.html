<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>簡易 PDF 簽名工具</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 pdf.js (渲染 PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <!-- 載入 pdf-lib.js (修改 PDF) -->
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <!-- 載入 signature_pad.js (簽名版) - 更換為 UMD 版本 -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <link rel="stylesheet" href="style.css?t=1731121200">
    <!-- Adobe Fonts for Trajan Pro (example) & Google Fonts for Roboto -->
    <link rel="stylesheet" href="https://use.typekit.net/af/trajan-pro-3/p.css?k=jkn5pzv&s=1&f=1&a=1&js=1&app=typekit&e=css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="citadel-container">
        <h1 class="text-3xl font-bold text-center mb-6">
            PDF Easy Sign 服務
        </h1>
        
        <!-- How to Use Section -->
        <div id="instructionsContainer" class="text-center">
            <ul class="instructions-list">
                <li><strong>步驟一：</strong>點擊下方按鈕上傳您的 PDF 文件。</li>
                <li><strong>步驟二：</strong>點擊文件預覽圖您想簽名的位置，並在彈出視窗中簽名。</li>
                <li><strong>步驟三：</strong>調整簽名位置與大小後，點擊下載按鈕即可儲存。</li>
            </ul>
        </div>

        <!-- 步驟一：上傳 -->
        <div id="uploadContainer" class="text-center">
            <label for="pdfUpload" class="mb-2">選擇要簽署的文件</label>
            <input type="file" id="pdfUpload" accept="application/pdf" class="block w-full max-w-md mx-auto">
        </div>

        <!-- 訊息與載入區域 -->
        <div id="messageArea" class="text-center my-4"></div>

        <!-- 步驟二：簽名 (PDF 預覽) -->
        <div id="controlsAndPdfContainer" class="hidden my-4">
            <div id="zoomControls" class="sticky top-0 z-10">
                <!-- PDF Zoom Controls -->
                <div class="control-group">
                    <button id="pdfZoomOutButton" title="縮小文件">-</button>
                    <div id="pdfZoomReset" class="font-medium px-2 cursor-pointer" title="重設縮放">
                        文件縮放 <span id="pdfZoomIndicator">100%</span>
                    </div>
                    <button id="pdfZoomInButton" title="放大文件">+</button>
                </div>

                <!-- Signature Zoom Controls -->
                <div class="control-group">
                    <button id="zoomOutButton" title="縮小簽名">-</button>
                    <span class="font-medium px-2">簽名縮放</span>
                    <button id="zoomInButton" title="放大簽名">+</button>
                </div>

                <!-- Confirm Position -->
                <div class="control-group">
                    <button id="confirmPositionButton" disabled>確認位置</button>
                </div>

                <!-- History -->
                <div class="control-group">
                    <button id="pdfUndoButton" disabled>上一步</button>
                    <span class="font-medium px-2">操作歷史</span>
                    <button id="pdfRedoButton" disabled>下一步</button>
                </div>

                <!-- Page Navigation -->
                <div class="control-group">
                    <button id="prevPageButton" disabled>‹ 上一頁</button>
                    <span id="pageIndicator" class="font-medium px-2">頁碼 0 / 0</span>
                    <button id="nextPageButton" disabled>下一頁 ›</button>
                </div>
            </div>
            
            <div id="pdfContainer" class="overflow-x-auto mt-4">
                <canvas id="pdfCanvas"></canvas>
            </div>
        </div>

        <!-- 步驟三：下載 -->
        <div id="downloadContainer" class="text-center hidden mt-6">
            <div class="mb-4 max-w-md mx-auto">
                <label for="fileName" class="block text-sm mb-1 text-left">下載檔名</label>
                <input type="text" id="fileName" value="已簽署文件" placeholder="例如：我的已簽署PDF">
            </div>

            <button id="downloadButton" class="btn btn-primary w-full max-w-md mx-auto">
                下載已簽署的 PDF
            </button>
        </div>
    </div>

    <!-- 簽名 Modal 彈窗 -->
    <div id="signatureModal" style="display: none;">
        <div class="modal-content">
            <h3 class="text-xl font-semibold mb-4 text-center">請在此處簽名授權</h3>
            <canvas id="signaturePad" class="mx-auto w-full h-64"></canvas>
            <div class="flex justify-center gap-2 md:gap-4 mt-4">
                <button id="cancelSigButton" class="btn btn-gray">取消</button>
                <button id="clearSigButton" class="btn">清除</button>
                <button id="saveSigButton" class="btn btn-primary">儲存簽名</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js?t=1731121200"></script>
</body>
    </html>
    